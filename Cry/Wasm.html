<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Cry::Wasm
  
    &mdash; Documentation by YARD 0.9.28
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Cry::Wasm";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (W)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Cry.html" title="Cry (module)">Cry</a></span></span>
     &raquo; 
    <span class="title">Wasm</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Cry::Wasm
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/cry/wasm.rb<span class="defines">,<br />
  lib/cry/wasm/version.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The Cry::Wasm module is for defining Ruby methods that will be compiled into WASM. use â€˜cry` to define the method signature. use `cry_wasm` to compile the method to WASM.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>class</span> <span class='const'>Foo</span>
  <span class='id identifier rubyid_extend'>extend</span> <span class='const'><span class='object_link'><a href="../Cry.html" title="Cry (module)">Cry</a></span></span><span class='op'>::</span><span class='const'>Wasm</span>
  <span class='id identifier rubyid_cry'>cry</span> <span class='lbracket'>[</span><span class='const'>Int32</span><span class='comma'>,</span> <span class='const'>Int32</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Int32</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_cry_wasm'>cry_wasm</span>
<span class='kw'>end</span>
<span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='comment'>#=&gt; 3</span></code></pre>
    
  </div>


</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extended-class_method" title="extended (class method)">.<strong>extended</strong>(obj)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#runtime-class_method" title="runtime (class method)">.<strong>runtime</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#runtime=-class_method" title="runtime= (class method)">.<strong>runtime=</strong>(runtime)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cry-instance_method" title="#cry (instance method)">#<strong>cry</strong>(arg_types, ret_type)  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Defines the method signature.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cry_wasm-instance_method" title="#cry_wasm (instance method)">#<strong>cry_wasm</strong>(wasm_out = nil, **options)  &#x21d2; Array&lt;Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Compile the method to WASM.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method_added-instance_method" title="#method_added (instance method)">#<strong>method_added</strong>(name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="extended-class_method">
  
    .<strong>extended</strong>(obj)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cry/wasm.rb', line 135</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_extended'>extended</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>
  <span class='comment'># Initialize class instance variables
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>class instance variable &#39;@cry_wasm&#39; is already defined</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_defined?'>instance_variable_defined?</span><span class='lparen'>(</span><span class='symbol'>:@cry_wasm</span><span class='rparen'>)</span>

  <span class='comment'># Only one class instance variable is used here.
</span>  <span class='comment'># to avoid bugs caused by overwriting.
</span>  <span class='ivar'>@cry_wasm_runtime</span> <span class='op'>||=</span> <span class='const'><span class='object_link'><a href="Wasmer.html" title="Cry::Wasmer (class)">Wasmer</a></span></span>
  <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@cry_wasm</span><span class='comma'>,</span> <span class='lbrace'>{</span>
                              <span class='label'>runtime:</span> <span class='ivar'>@cry_wasm_runtime</span><span class='comma'>,</span>
                              <span class='label'>flag:</span> <span class='kw'>false</span><span class='comma'>,</span>
                              <span class='label'>marked_methods:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
                              <span class='label'>fname:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
                              <span class='label'>line_number:</span> <span class='int'>0</span><span class='comma'>,</span>
                              <span class='label'>compiler:</span> <span class='const'><span class='object_link'><a href="Compiler.html" title="Cry::Compiler (class)">Compiler</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Compiler.html#initialize-instance_method" title="Cry::Compiler#initialize (method)">new</a></span></span><span class='comma'>,</span>
                              <span class='label'>codegen:</span> <span class='const'><span class='object_link'><a href="Codegen.html" title="Cry::Codegen (class)">Codegen</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Codegen.html#initialize-instance_method" title="Cry::Codegen#initialize (method)">new</a></span></span>
                            <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="runtime-class_method">
  
    .<strong>runtime</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cry/wasm.rb', line 30</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_runtime'>runtime</span>
  <span class='ivar'>@cry_wasm_runtime</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="runtime=-class_method">
  
    .<strong>runtime=</strong>(runtime)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cry/wasm.rb', line 26</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_runtime='>runtime=</span><span class='lparen'>(</span><span class='id identifier rubyid_runtime'>runtime</span><span class='rparen'>)</span>
  <span class='ivar'>@cry_wasm_runtime</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cry-instance_method">
  
    #<strong>cry</strong>(arg_types, ret_type)  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Defines the method signature. This method must be called before the target method is defined.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>arg_types</span>
      
      
        <span class='type'>(<tt>Array&lt;String, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>crystal argument types</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ret_type</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>crystal return type</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61
62
63
64
65
66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cry/wasm.rb', line 57</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cry'>cry</span><span class='lparen'>(</span><span class='id identifier rubyid_arg_types'>arg_types</span><span class='comma'>,</span> <span class='id identifier rubyid_ret_type'>ret_type</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fname'>fname</span><span class='comma'>,</span> <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='id identifier rubyid_caller'>caller</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>:</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:codegen</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_source_path'>source_path</span> <span class='op'>=</span> <span class='id identifier rubyid_fname'>fname</span>

  <span class='comment'># Searches for methods that appear on a line later than cry was called.
</span>  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:caller_line_number</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_l'>l</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:flag</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@crystal_arg_types</span> <span class='op'>=</span> <span class='id identifier rubyid_arg_types'>arg_types</span>
  <span class='ivar'>@crystal_ret_type</span> <span class='op'>=</span> <span class='id identifier rubyid_ret_type'>ret_type</span>

  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cry_wasm-instance_method">
  
    #<strong>cry_wasm</strong>(wasm_out = nil, **options)  &#x21d2; <tt>Array&lt;Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Compile the method to WASM. This method must be called after the target methods are defined.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>wasm_out</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>output path of WASM</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>options for Cry::Compiler#build_wasm</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>method names that were compiled to WASM</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cry/wasm.rb', line 76</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cry_wasm'>cry_wasm</span><span class='lparen'>(</span><span class='id identifier rubyid_wasm_out'>wasm_out</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_crystal_code'>crystal_code</span> <span class='op'>=</span> <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:codegen</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_crystal_code'>crystal_code</span>
  <span class='id identifier rubyid_wasm_bytes'>wasm_bytes</span> <span class='op'>=</span> <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:compiler</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_build_wasm'>build_wasm</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_crystal_code'>crystal_code</span><span class='comma'>,</span>
    <span class='label'>export:</span> <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:codegen</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_function_names'>function_names</span><span class='comma'>,</span> <span class='comment'># There are other methods other than marked_method that must be exported.
</span>    <span class='label'>output:</span> <span class='id identifier rubyid_wasm_out'>wasm_out</span><span class='comma'>,</span>
    <span class='op'>**</span><span class='id identifier rubyid_options'>options</span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_runtime'>runtime</span> <span class='op'>=</span> <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:runtime</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_wasm_bytes'>wasm_bytes</span><span class='rparen'>)</span>
  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:marked_methods</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
    <span class='id identifier rubyid_func'>func</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_function'>function</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_itfc'>itfc</span> <span class='op'>=</span> <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:codegen</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_interface'>interface</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_define_method'>define_method</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_kwargs'>kwargs</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
      <span class='comment'># NOTE: This is a temporary implementation.
</span>      <span class='comment'>#       In the future, keyword arguments may be used
</span>      <span class='comment'>#       as a specification of local variable types.
</span>      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>keyword arguments are not supported</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_kwargs'>kwargs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>block is not supported</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>

      <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_itfc'>itfc</span><span class='period'>.</span><span class='id identifier rubyid_crystal_arg_types'>crystal_arg_types</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_arg'>arg</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_is_array?'>is_array?</span> <span class='op'>||</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_is_pointer?'>is_pointer?</span>
          <span class='id identifier rubyid_t2'>t2</span> <span class='op'>=</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_inner'>inner</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span>
          <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='id identifier rubyid_arg'>arg</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

          <span class='id identifier rubyid_addr'>addr</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_invoke'>invoke</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>__alloc_buffer_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t2'>t2</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_l'>l</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_write_memory'>write_memory</span><span class='lparen'>(</span><span class='id identifier rubyid_addr'>addr</span><span class='comma'>,</span> <span class='id identifier rubyid_t2'>t2</span><span class='comma'>,</span> <span class='id identifier rubyid_arg'>arg</span><span class='rparen'>)</span>

          <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_addr'>addr</span>
          <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_l'>l</span> <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_is_array?'>is_array?</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_arg'>arg</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_r'>r</span> <span class='op'>=</span> <span class='id identifier rubyid_itfc'>itfc</span><span class='period'>.</span><span class='id identifier rubyid_crystal_ret_type'>crystal_ret_type</span>
      <span class='id identifier rubyid_addr2'>addr2</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_is_array?'>is_array?</span>
        <span class='id identifier rubyid_addr2'>addr2</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_invoke'>invoke</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>__alloc_buffer_int32</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_write_memory'>write_memory</span><span class='lparen'>(</span><span class='id identifier rubyid_addr2'>addr2</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>int32</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_new_args'>new_args</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_addr2'>addr2</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_new_args'>new_args</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_is_pointer?'>is_pointer?</span>
        <span class='id identifier rubyid_view'>view</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_get_view'>get_view</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_inner'>inner</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_is_array?'>is_array?</span>
        <span class='id identifier rubyid_l2'>l2</span> <span class='op'>=</span> <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_read_memory'>read_memory</span><span class='lparen'>(</span><span class='id identifier rubyid_addr2'>addr2</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>int32</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_runtime'>runtime</span><span class='period'>.</span><span class='id identifier rubyid_read_memory'>read_memory</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_inner'>inner</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span> <span class='id identifier rubyid_l2'>l2</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span>
      <span class='kw'>end</span>
      <span class='comment'># FIXME: Release memory
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="method_added-instance_method">
  
    #<strong>method_added</strong>(name)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cry/wasm.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method_added'>method_added</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:flag</span><span class='rbracket'>]</span>

  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:codegen</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_add_crystal_function'>add_crystal_function</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span>
    <span class='ivar'>@crystal_arg_types</span><span class='comma'>,</span>
    <span class='ivar'>@crystal_ret_type</span><span class='comma'>,</span>
    <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:caller_line_number</span><span class='rbracket'>]</span>
  <span class='rparen'>)</span>

  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:marked_methods</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:caller_line_number</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@cry_wasm</span><span class='lbracket'>[</span><span class='symbol'>:flag</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span>

  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Dec 18 06:07:49 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.3).
</div>

    </div>
  </body>
</html>